# 📋 План разработки Multi-Parameter Data Analyzer v1.1

## 🎯 Цель версии 1.1
Добавление поддержки общей временной шкалы при сохранении всех существующих функций v1.0.

## 🔧 Основная проблема v1.0
**Проблема:** Все параметры привязаны к одному столбцу времени, но в реальных данных у каждого параметра может быть свой столбец времени.

**Пример данных:**
```
Date/Time1    | Information1 | Date/Time2    | Information2 | Date/Time3    | Information3
19.02.2025... | 0.86         | 19.02.2025... | 0.67         | 19.02.2025... | 8.5
19.02.2025... | 8.6          | 19.02.2025... | 6.6          | 19.02.2025... | 9.2
```

## 🚀 Простое решение v1.1

### Основная идея
Добавить возможность **точной привязки "время → параметр"** с последующим объединением в общую временную шкалу для удобного просмотра.

### Ключевые особенности:
1. **Сохранение режима v1.0** - один столбец времени для всех параметров (совместимость)
2. **Новый режим "Парная привязка"** - каждый параметр привязывается к своему столбцу времени
3. **Общая временная ось** - для удобного просмотра всех данных на одном графике
4. **Ручная настройка пар** - пользователь сам указывает соответствие время → параметр

## 📝 Техническая реализация

### 1. Расширение `select_columns()` - два режима в одном диалоге
```
┌─ Режим работы ─────────────────────────────────────┐
│ ○ Режим v1.0 (один столбец времени для всех)       │
│ ● Режим v1.1 (парная привязка время → параметр)    │
└────────────────────────────────────────────────────┘
```

### 2. Интерфейс парной привязки
```python
# Пользователь настраивает пары:
time_param_pairs = [
    ("Date/Time1", "Information1"),
    ("Date/Time2", "Information2"), 
    ("Date/Time1", "Information3")  # Несколько параметров к одному времени
]
```

### 3. Алгоритм отображения v1.1
```python
def update_plot(self):
    if self.mode == "v1.1_paired":
        # Создаем общую временную ось из всех столбцов времени
        all_time_columns = [pair[0] for pair in self.time_param_pairs]
        combined_timeline = self.create_combined_timeline(all_time_columns)
        
        # Отображаем каждый параметр точно по его времени
        for time_col, param_col in self.time_param_pairs:
            self.plot_parameter_with_exact_time(time_col, param_col, combined_timeline)
    else:
        # Режим v1.0 - без изменений
        # ...существующий код...
```

### 2. Модификация `select_columns()`
- **Переключатель режима:** Радио-кнопки для выбора между v1.0 и v1.1
- **Режим v1.0:** Выпадающий список времени + список параметров (как сейчас)
- **Режим v1.1:** Таблица пар "время → параметр" с кнопками добавить/удалить
- **Обратная совместимость:** По умолчанию включен режим v1.0

### 3. Простое обновление `update_plot()`
- **Условная логика:** Проверка режима работы (v1.0 или v1.1)
- **Парное отображение:** Каждый параметр отображается точно по своему времени
- **Общая временная ось:** Объединение всех временных столбцов из пар
- **Сохранение всех функций:** Zoom, pan, cursor tracking остаются без изменений

## 🗂️ Алгоритм работы v1.1

### Этап 1: Загрузка и анализ данных (без изменений)
1. Загрузка CSV/Excel файла
2. Отображение всех столбцов в интерфейсе выбора

### Этап 2: Выбор пользователя (с дополнением)
1. **Режим v1.0:** Выбор одного столбца времени + список параметров (как раньше)
2. **Режим v1.1:** Настройка пар "время → параметр" в таблице
3. **Совместимость:** Возможность использовать один столбец времени для нескольких параметров
4. Настройка цветов (без изменений)

### Этап 3: Построение графика
1. **Режим v1.0:** Работает как раньше
2. **Режим v1.1:** 
   - Создание общей временной оси из всех столбцов времени из пар
   - Отображение каждого параметра точно по своему времени
   - Объединение всех данных на едином графике с общей временной шкалой

## 🎛️ Новый интерфейс выбора

### Режим v1.0 (совместимость):
```
┌─ Режим работы ─────────────────────────────────────┐
│ ● Режим v1.0 (один столбец времени для всех)       │
│ ○ Режим v1.1 (парная привязка время → параметр)    │
└────────────────────────────────────────────────────┘

┌─ Столбец времени ─────────────────────────────────────┐
│ [Date/Time1          ▼]                               │
└────────────────────────────────────────────────────────┘

┌─ Параметры для отображения ───────────────────────────┐
│ ☑ Information1  [red ▼]                                │
│ ☑ Information2  [green ▼]                              │
│ ☐ Information3  [blue ▼]                               │
└────────────────────────────────────────────────────────┘
```

### Режим v1.1 (парная привязка):
```
┌─ Режим работы ─────────────────────────────────────┐
│ ○ Режим v1.0 (один столбец времени для всех)       │
│ ● Режим v1.1 (парная привязка время → параметр)    │
└────────────────────────────────────────────────────┘

┌─ Пары время → параметр ────────────────────────────┐
│ [Date/Time1  ▼] → [Information1 ▼] [red ▼]  [×]    │
│ [Date/Time2  ▼] → [Information2 ▼] [green ▼] [×]   │
│ [Date/Time1  ▼] → [Information3 ▼] [blue ▼]  [×]   │
│ [+ Добавить пару]                                   │
└────────────────────────────────────────────────────┘
```

**[OK] [Отмена]**

## 📅 План разработки (2-3 дня)

### Этап 1: Расширение интерфейса выбора столбцов (1 день)
- [ ] Добавление радио-кнопок для переключения между режимами v1.0 и v1.1
- [ ] Создание интерфейса таблицы пар "время → параметр" для режима v1.1
- [ ] Кнопки "Добавить пару" и "Удалить пару" с валидацией
- [ ] Логика переключения интерфейса между режимами

### Этап 2: Реализация парной привязки и общей временной шкалы (1 день)
- [ ] Функция `create_combined_timeline()` из всех временных столбцов пар
- [ ] Модификация `update_plot()` для режима v1.1 с парной привязкой
- [ ] Точное отображение каждого параметра по своему времени
- [ ] Сохранение всех интерактивных функций (zoom, pan, cursor)

### Этап 3: Тестирование и отладка (1 день)
- [ ] Тестирование с файлами, содержащими несколько столбцов времени
- [ ] Проверка совместимости с режимом v1.0
- [ ] Тестирование производительности с большими данными
- [ ] Исправление найденных ошибок

## 📊 Ожидаемые улучшения

### Гибкость работы с данными:
- ✅ Точная привязка каждого параметра к своему столбцу времени
- ✅ Возможность использования одного столбца времени для нескольких параметров
- ✅ Сохранение всех данных без потерь точности
- ✅ Работа с файлами любой структуры

### Простота использования:
- ✅ Интуитивно понятный интерфейс с таблицей пар
- ✅ Полная обратная совместимость с v1.0
- ✅ Ручная настройка для полного контроля
- ✅ Валидация ввода для предотвращения ошибок

### Производительность:
- ✅ Быстрая обработка без сложных вычислений
- ✅ Эффективное объединение временных меток
- ✅ Отзывчивый интерфейс

## 🔧 Технические детали

### Объединение временных меток:
1. Сбор всех временных меток из выбранных столбцов времени из пар
2. Удаление дубликатов и сортировка в хронологическом порядке
3. Создание общей временной оси для всех параметров

### Отображение данных:
1. Каждый параметр отображается точно по своему времени из пары
2. Точки данных появляются только там, где есть реальные значения
3. Пропуски в данных отображаются как разрывы линий
4. Несколько параметров могут использовать один столбец времени

### Совместимость:
- Полное сохранение функциональности v1.0
- Автоматическое определение режима работы
- Без изменений в основных алгоритмах обработки графика

---

**Статус:** 🚀 Готов к разработке  
**Ветка:** `v1.1-combined-timeline`  
**Начало разработки:** 12 июня 2025  
**Планируемый релиз:** v1.1 - 15 июня 2025

**Преимущества упрощенного подхода:**
- 🎯 Максимально простая реализация
- ⚡ Быстрая разработка (2-3 дня вместо 5-7)
- 🔄 100% обратная совместимость  
- 🛡️ Минимальный риск ошибок
- 👤 Полный контроль пользователя над выбором столбцов
